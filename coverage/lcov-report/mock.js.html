<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for mock.js</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="prettify.css" />
    <link rel="stylesheet" href="base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="index.html">All files</a> mock.js
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">7.58% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>5/66</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">2.17% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>1/46</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>0/15</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">7.94% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>5/63</span>
      </div>
    </div>
  </div>
  <div class='status-line low'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">import { _, base } from './utils'
&nbsp;
let jsf = <span class="fstat-no" title="function not covered" >() =&gt; ({})</span>
<span class="missing-if-branch" title="else path not taken" >E</span>if (!process.env.MODELIZR_CHEAP_MOCK) {
    jsf = require('json-schema-faker')
}
&nbsp;
const mock = base()
mock.Class = class extends mock.Class {
&nbsp;
    response() {
<span class="cstat-no" title="statement not covered" >        const cache = {}</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >        const mock = <span class="fstat-no" title="function not covered" >models =&gt; _.extractMockedObjects(_.mapValid(models, <span class="fstat-no" title="function not covered" >model =&gt; {</span></span></span>
<span class="cstat-no" title="statement not covered" ></span>            if (typeof model.build === 'function') {
<span class="cstat-no" title="statement not covered" >                model = model.build()</span>
            }
&nbsp;
<span class="cstat-no" title="statement not covered" >            const rand = <span class="fstat-no" title="function not covered" >model =&gt; {</span></span>
<span class="cstat-no" title="statement not covered" >                let result</span>
<span class="cstat-no" title="statement not covered" >                let count = 0</span>
<span class="cstat-no" title="statement not covered" ><span class="cstat-no" title="statement not covered" ></span>                for (const prop in model.models)</span>
<span class="cstat-no" title="statement not covered" ></span>                    if (Math.random() &lt; 1 / ++count)
<span class="cstat-no" title="statement not covered" >                        result = model.models[prop]</span>
                return result
            }
&nbsp;
<span class="cstat-no" title="statement not covered" >            model._modelType = model._modelType || 'arrayOf'</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >            const primary = model.primaryKey || 'id'</span>
<span class="cstat-no" title="statement not covered" >            const response = {}</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >            const newId = _.size(cache[model.key]) + 1</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >            let id = newId</span>
&nbsp;
<span class="cstat-no" title="statement not covered" ></span>            if (model._modelType == 'arrayOf' || model._modelType == 'valuesOf') {
<span class="cstat-no" title="statement not covered" >                id = _.range(newId, newId + 20)</span>
            }
&nbsp;
<span class="cstat-no" title="statement not covered" ></span>            if (model.params) {
<span class="cstat-no" title="statement not covered" ></span>                if (model.params[primary]) {
<span class="cstat-no" title="statement not covered" >                    id = model.params[primary]</span>
                }
            }
&nbsp;
<span class="cstat-no" title="statement not covered" >            const getFromCache = <span class="fstat-no" title="function not covered" >id =&gt; {</span></span>
<span class="cstat-no" title="statement not covered" >                let _model = model</span>
<span class="cstat-no" title="statement not covered" >                let schemaAttribute = model.schemaAttribute</span>
&nbsp;
<span class="cstat-no" title="statement not covered" ></span>                if (model._isUnion) {
<span class="cstat-no" title="statement not covered" >                    _model = {</span>
                        ...rand(model).schema,
                        type: 'object'
                    }
<span class="cstat-no" title="statement not covered" >                    _model.model = <span class="fstat-no" title="function not covered" >() =&gt; _model.model</span></span>
                }
&nbsp;
<span class="cstat-no" title="statement not covered" >                const mergeNested = <span class="fstat-no" title="function not covered" >mockedModel =&gt; ({</span></span>
                    ...mockedModel,
                    ...mock(_.map(_.filter(_model.properties, <span class="fstat-no" title="function not covered" >prop =&gt; prop._isModel || prop._isUnion), <span class="fstat-no" title="function not covered" >childModel =&gt; {</span></span>
<span class="cstat-no" title="statement not covered" >                        childModel._modelType = _model._mockTypes[childModel.key] || 'arrayOf'</span>
<span class="cstat-no" title="statement not covered" >                        return childModel</span>
                    }))
                })
&nbsp;
<span class="cstat-no" title="statement not covered" >                _model.properties = _.pickBy(_.mapValues(_model.properties, <span class="fstat-no" title="function not covered" >(prop, key) =&gt; {</span></span>
<span class="cstat-no" title="statement not covered" ></span>                    if (typeof prop.type === 'function') {
<span class="cstat-no" title="statement not covered" >                        const gen = prop.type()</span>
<span class="cstat-no" title="statement not covered" ></span>                        i</span>f (gen._schema.key == model.propertyOf) <span class="cstat-no" title="statement not covered" >return undefined
<span class="cstat-no" title="statement not covered" >                        return {...gen.build(), propertyOf: key}</span>
                    }
<span class="cstat-no" title="statement not covered" >                    return prop</span>
                }), <span class="fstat-no" title="function not covered" >prop =&gt; prop)</span>
&nbsp;
<span class="cstat-no" title="statement not covered" ></span>                if (cache[_model.key] &amp;&amp; cache[_model.key][id]) {
<span class="cstat-no" title="statement not covered" ></span>                    i</span>f (model._isUnion) <span class="cstat-no" title="statement not covered" >cache[_model.key][id][schemaAttribute] = _model.key
<span class="cstat-no" title="statement not covered" >                    return mergeNested(cache[_model.key][id])</span>
                }
<span class="cstat-no" title="statement not covered" >                let mocked = _.set(jsf(_model), primary, id)</span>
<span class="cstat-no" title="statement not covered" ></span>                if (model._isUnion) {
<span class="cstat-no" title="statement not covered" >                    mocked = _.set(mocked, schemaAttribute, _model.key)</span>
                }
&nbsp;
<span class="cstat-no" title="statement not covered" >                cache[_model.key] = {...cache[_model.key], [id]: mocked}</span>
<span class="cstat-no" title="statement not covered" >                return mergeNested(mocked)</span>
            }
&nbsp;
<span class="cstat-no" title="statement not covered" >            if (Array.isArray(id)) {</span>
<span class="cstat-no" title="statement not covered" >                response[model.key] = _.map(id, <span class="fstat-no" title="function not covered" >id =&gt; getFromCache(id))</span></span>
<span class="cstat-no" title="statement not covered" ></span>                if (model._modelType == 'valuesOf') {
<span class="cstat-no" title="statement not covered" >                    response[model.key] = _.mapKeys(response[model.key], <span class="fstat-no" title="function not covered" >entity =&gt; entity[primary])</span></span>
                }
            } else <span class="cstat-no" title="statement not covered" ></span>if (typeof id === 'number') {
<span class="cstat-no" title="statement not covered" >                response[model.key] = getFromCache(id)</span>
            } else {
<span class="cstat-no" title="statement not covered" >                response[model.key] = getFromCache(1)</span>
            }
&nbsp;
<span class="cstat-no" title="statement not covered" >            return response</span>
        }))
&nbsp;
<span class="cstat-no" title="statement not covered" >        return new Promise(<span class="fstat-no" title="function not covered" >(resolve, reject) =&gt; {</span></span>
<span class="cstat-no" title="statement not covered" >            setTimeout(<span class="fstat-no" title="function not covered" >() =&gt; {</span></span>
<span class="cstat-no" title="statement not covered" ></span>                if (this._error) {
<span class="cstat-no" title="statement not covered" ></span>                    if (this._error == 'throw') {
<span class="cstat-no" title="statement not covered" >                        reject(new Error('Mocked Error'))</span>
                    } else {
<span class="cstat-no" title="statement not covered" >                        resolve({</span>
                            status: this._error,
                            body: {}
                        })
                    }
                } else {
<span class="cstat-no" title="statement not covered" >                    resolve({</span>
                        status: 200,
                        body: mock(...this._models)
                    })
                }
            }, this._mockDelay)
        })
    }
}
&nbsp;
export { mock as default, mock }</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Thu May 19 2016 21:04:12 GMT+0200 (SAST)
</div>
</div>
<script src="prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="sorter.js"></script>
</body>
</html>
